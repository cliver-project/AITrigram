apiVersion: aitrigram.io/v1
kind: AssetConfig
metadata:
  name: huggingface-default
  origin: huggingface

# Container image to run scripts in
image: python:3.11-slim

# Download job configuration
download:
  scriptFile: download.py
  interpreter: python3

  # Environment variables - all required variables must be defined here
  # Runtime values are resolved from valueFrom:
  #   - "mountPath": Resolved to actual storage mount path
  #   - "secret:hfTokenSecretRef": Resolved from ModelSource.HFTokenSecretRef (optional)
  # Parameters (MODEL_ID, REVISION) are automatically added by controller
  environment:
    - name: HF_HOME
      valueFrom: mountPath
    - name: HF_HUB_CACHE
      valueFrom: mountPath
    - name: HF_TOKEN
      valueFrom: secret:hfTokenSecretRef  # Optional: from ModelSource.HFTokenSecretRef

  # Resource requirements (K8s native format - easily extensible for GPUs, etc.)
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m

  # Security context - HuggingFace requirements
  # Note: runAsUser/runAsGroup not specified for OpenShift compatibility
  # OpenShift will automatically assign UID/GID from namespace's allowed range
  securityContext:
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false  # HuggingFace Hub needs to write cache
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

# Cleanup job configuration
cleanup:
  scriptFile: cleanup.py
  interpreter: python3

  # Environment variables for cleanup
  environment:
    - name: HF_HOME
      valueFrom: mountPath

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 1000m

  # Security context - Same as download for consistency
  # Note: runAsUser/runAsGroup not specified for OpenShift compatibility
  # OpenShift will automatically assign UID/GID from namespace's allowed range
  securityContext:
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

# Volume mount configuration
volumeMount:
  defaultPath: /data/models
  name: model-storage
  readOnly: false  # For download/cleanup jobs
