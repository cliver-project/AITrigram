apiVersion: aitrigram.io/v1
kind: AssetConfig
metadata:
  name: ollama-default
  origin: ollama

# Container image to run scripts in
image: ollama/ollama:latest

# Download job configuration
download:
  scriptFile: download.sh
  interpreter: bash

  # Environment variables - all required variables must be defined here
  # Runtime values are resolved from valueFrom:
  #   - "mountPath": Resolved to actual storage mount path
  # Parameters (MODEL_NAME) are automatically added by controller
  environment:
    - name: HOME
      valueFrom: mountPath  # Ollama needs writable HOME for config files
    - name: OLLAMA_HOME
      valueFrom: mountPath
    - name: OLLAMA_MODELS
      valueFrom: mountPath

  # Resource requirements (K8s native format - easily extensible for GPUs, etc.)
  resources:
    requests:
      memory: 1Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

  # Security context - Ollama-specific requirements
  # Note: runAsUser/runAsGroup not specified for OpenShift compatibility
  # OpenShift will automatically assign UID/GID from namespace's allowed range
  securityContext:
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false  # Ollama needs to write to ~/.ollama and cache models
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

# Cleanup job configuration
cleanup:
  scriptFile: cleanup.sh
  interpreter: bash

  environment:
    - name: HOME
      valueFrom: mountPath
    - name: OLLAMA_HOME
      valueFrom: mountPath
    - name: OLLAMA_MODELS
      valueFrom: mountPath

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 1000m

  # Security context - Same as download for consistency
  # Note: runAsUser/runAsGroup not specified for OpenShift compatibility
  # OpenShift will automatically assign UID/GID from namespace's allowed range
  securityContext:
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

# Volume mount configuration
volumeMount:
  defaultPath: /data/models
  name: model-storage
  readOnly: false  # For download/cleanup jobs
